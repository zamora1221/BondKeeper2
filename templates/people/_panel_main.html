{% load static %}
{% if person %}
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px">
    <h3 style="margin:0">
      {% if person.full_name %}{{ person.full_name }}{% else %}{{ person.first_name }} {{ person.last_name }}{% endif %}
    </h3>

    <div style="display:flex; gap:8px">
      <!-- Add Indemnitor -->
      <button class="btn primary"
              hx-get="{% url 'indemnitor_new_partial' person.pk %}"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              onclick="document.getElementById('modal').showModal()">
        + Add Indemnitor
      </button>

      <!-- Add Reference -->
      <button class="btn primary"
              hx-get="{% url 'reference_new_partial' person.pk %}"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              onclick="document.getElementById('modal').showModal()">
        + Add Reference
      </button>
    </div>
  </div>

  <!-- Contact -->
  <div class="section">
    <h4>Contact</h4>
    <div class="kv"><label>Phone</label><div class="v">{{ person.phone|default:"-" }}</div></div>
    <div class="kv"><label>Email</label><div class="v">{{ person.email|default:"-" }}</div></div>
  </div>

  <!-- Address -->
  <div class="section">
    <h4>Address</h4>
    <div class="kv"><label>Street</label><div class="v">{{ person.address|default:"-" }}</div></div>
    <div class="kv"><label>City</label><div class="v">{{ person.city|default:"-" }}</div></div>
    <div class="kv"><label>State</label><div class="v">{{ person.state|default:"-" }}</div></div>
    <div class="kv"><label>ZIP</label><div class="v">{{ person.zip|default:"-" }}</div></div>
  </div>

  <!-- Details -->
  <div class="section">
    <h4>Details</h4>
    <div class="kv"><label>DOB</label><div class="v">{{ person.dob|date:"Y-m-d"|default:"-" }}</div></div>
    <div class="kv"><label>Alias</label><div class="v">{{ person.alias|default:"-" }}</div></div>
    <div class="kv"><label>Notes</label><div class="v">{{ person.notes|default:"" }}</div></div>
  </div>

  <!-- Indemnitors -->
  <div class="section">
    <h4>Indemnitors</h4>
    {% with inds=person.indemnitors.all %}
      {% if inds %}
        <ul style="margin:6px 0 0 16px; list-style:disc">
          {% for i in inds %}
            <li>
              <a href="#"
                 hx-get="{% url 'indemnitor_edit_partial' i.pk %}"
                 hx-target="#modal-body"
                 hx-swap="innerHTML"
                 onclick="document.getElementById('modal').showModal()"
                 style="font-weight:600; text-decoration:none">
                {{ i.name }}
              </a>
              {% if i.relationship %} ({{ i.relationship }}){% endif %}
              {% if i.phone %} — {{ i.phone }}{% endif %}
              {% if i.email %} — {{ i.email }}{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <em class="small">No indemnitors yet.</em>
      {% endif %}
    {% endwith %}
  </div>

  <!-- References -->
  <section class="card" style="margin-top:12px">
    <div class="card-header" style="display:flex; align-items:center; justify-content:space-between; gap:8px">
      <h3 style="margin:0">References</h3>
      <button class="btn primary"
              hx-get="{% url 'reference_new_partial' person.pk %}"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              onclick="document.getElementById('modal').showModal()">
        + Add Reference
      </button>
    </div>

    <div class="card-body">
      <ul class="list" style="margin:0; padding:0; list-style:none">
        {% for ref in person.references.all %}
          <li style="padding:8px 0; border-bottom:1px solid #eee">
            <a href="#"
               hx-get="{% url 'reference_edit_partial' ref.pk %}"
               hx-target="#modal-body"
               hx-swap="innerHTML"
               onclick="document.getElementById('modal').showModal()"
               style="font-weight:600; text-decoration:none">
              {{ ref.name }}
            </a>
            <div class="muted">
              {{ ref.relationship|default:"Reference" }}
              {% if ref.phone %} • {{ ref.phone }}{% endif %}
              {% if ref.email %} • {{ ref.email }}{% endif %}
            </div>
          </li>
        {% empty %}
          <div class="muted">No references yet.</div>
        {% endfor %}
      </ul>
    </div>
  </section>
{% else %}
  <div class="muted">No person selected yet — start by adding a new one.</div>
{% endif %}
