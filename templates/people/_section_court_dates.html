{# templates/people/_section_court_dates.html #}
<div id="court-dates-section" class="section"
     hx-on:htmx:afterSwap="document.getElementById('modal')?.close()">

  <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px">
    <h4 style="margin:0">Court Dates</h4>
    {% if person %}
      <button class="btn"
              hx-get="{% url 'court_date_new_partial' person.pk %}"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              onclick="document.getElementById('modal').showModal()">
        + Add Court Date
      </button>
    {% endif %}
  </div>

  <style>
    .court-table { width: 100%; border-collapse: collapse; }
    .court-table th, .court-table td { padding: 8px 10px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    .court-table thead th { text-align: left; font-weight: 700; color: #334155; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
    .court-table tbody tr:hover { background: #f9fafb; }
    .actions { white-space: nowrap; display: flex; gap: 6px; }
  </style>

  {% if person %}
    {% with items=person.court_dates.all %}
      {% if items %}
        <table class="court-table">
          <thead>
            <tr>
              <th style="width:110px">Date</th>
              <th style="width:90px">Time</th>
              <th>Court</th>
              <th>Location</th>
              <th style="width:130px">Case #</th>
              <th>Notes</th>
              <th style="width:140px">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for cd in items %}
              <tr>
                <td>{{ cd.date|date:"Y-m-d"|default:"" }}</td>
                <td>{{ cd.time|time:"H:i"|default:"" }}</td>
                <td>{{ cd.court|default:"" }}</td>
                <td>{{ cd.location|default:"" }}</td>
                <td>{{ cd.case_number|default:"" }}</td>
                <td>{{ cd.notes|default:"" }}</td>
                <td class="actions">
                  <button class="btn small"
        hx-get="{% url 'court_date_edit_partial' cd.pk %}"
        hx-target="#modal-body"
        hx-swap="innerHTML"
        onclick="document.getElementById('modal').showModal()">
  Edit
</button>


                  {# inside the Actions column for each court date row #}
<a class="btn small"
   href="{% url 'court_date_notice' cd.pk %}"
   target="_blank" rel="noopener">
  Print Notice
</a>

                  <form action="{% url 'court_date_delete' cd.pk %}"
                        method="post"
                        hx-post="{% url 'court_date_delete' cd.pk %}"
                        hx-target="#court-dates-section"
                        hx-swap="outerHTML"
                        hx-confirm="Delete this court date?"
                        style="display:inline-block; margin:0">
                    {% csrf_token %}
                    <button type="submit" class="btn danger small">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="muted">No court dates yet.</div>
      {% endif %}
    {% endwith %}
  {% else %}
    <em class="small">Select or create a person to manage court dates.</em>
  {% endif %}
</div>
