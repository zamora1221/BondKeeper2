{# templates/people/_section_checkins.html #}
<div id="checkins-section" class="section"
     hx-on:htmx:afterSwap="document.getElementById('modal')?.close()">

  <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px">
    <h4 style="margin:0">Check Ins</h4>
    {% if person %}
      <button class="btn"
              hx-get="{% url 'checkin_new_partial' person.pk %}"
              hx-target="#modal-body"
              hx-swap="innerHTML"
              onclick="document.getElementById('modal').showModal()">
        + Add Check In
      </button>
    {% endif %}
  </div>

  <style>
    .checkins-table { width: 100%; border-collapse: collapse; }
    .checkins-table th, .checkins-table td { padding: 8px 10px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    .checkins-table thead th { text-align: left; font-weight: 700; color: #334155; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
    .checkins-table tbody tr:hover { background: #f9fafb; }
    .actions { white-space: nowrap; display: flex; gap: 6px; }
  </style>

  {% if person %}
    {% with items=person.checkins.all %}
      {% if items %}
        <table class="checkins-table">
          <thead>
            <tr>
              <th>Phone</th>
              <th>Address</th>
              <th style="width:140px">Method</th>
              <th style="width:140px">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for ci in items %}
              <tr>
                <td>{{ ci.phone|default:"" }}</td>
                <td>{{ ci.address|default:"" }}</td>
                <td>
                  {% if ci.method == 'phone' %}Phone{% elif ci.method == 'online' %}Online{% else %}In-person{% endif %}
                </td>
                <td class="actions">
                  <button class="btn small"
                          hx-get="{% url 'checkin_edit_partial' ci.pk %}"
                          hx-target="#modal-body"
                          hx-swap="innerHTML"
                          onclick="document.getElementById('modal').showModal()">
                    Edit
                  </button>
                  <form action="{% url 'checkin_delete' ci.pk %}"
                        method="post"
                        hx-post="{% url 'checkin_delete' ci.pk %}"
                        hx-target="#checkins-section"
                        hx-swap="outerHTML"
                        hx-confirm="Delete this check-in?"
                        style="display:inline-block; margin:0">
                    {% csrf_token %}
                    <button type="submit" class="btn danger small">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="muted">No check-ins yet.</div>
      {% endif %}
    {% endwith %}
  {% else %}
    <em class="small">Select or create a person to manage check-ins.</em>
  {% endif %}
</div>
