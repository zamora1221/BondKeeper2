
{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}People{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'app.css' %}">
  <style>
  /* =========================
     1) Tabs — blue theme
     ========================= */
  /* Base (unselected) */
  [role="tab"],
  .tabs .tab, .subtabs .tab,
  .tabs a, .tabs button,
  .subtabs a, .subtabs button,
  .nav-tabs .tab, .nav-tabs .nav-link,
  .tab, .tab-link, .pill, .pills .pill {
    background-color: #2563EB !important;   /* blue-600 */
    border-color: #2563EB !important;
    color: #FFFFFF !important;
    background-image: none !important;
  }
  /* Hover */
  [role="tab"]:hover,
  .tabs .tab:hover, .subtabs .tab:hover,
  .tabs a:hover, .tabs button:hover,
  .subtabs a:hover, .subtabs button:hover,
  .nav-tabs .tab:hover, .nav-tabs .nav-link:hover,
  .tab:hover, .tab-link:hover, .pill:hover, .pills .pill:hover {
    background-color: #1D4ED8 !important;   /* blue-700 */
    border-color: #1D4ED8 !important;
    color: #FFFFFF !important;
  }
  /* Active / selected */
  [role="tab"][aria-selected="true"],
  .nav-tabs .active, .tabs .tab.active, .subtabs .tab.active,
  .tab.active, .tab[aria-current], .tab[aria-selected="true"],
  .nav-link.active, .pill.active, .pills .pill.active {
    background-color: #1E40AF !important;   /* blue-800 */
    border-color: #1E40AF !important;
    color: #FFFFFF !important;
  }
  /* Focus ring */
  [role="tab"]:focus-visible,
  .tabs .tab:focus-visible, .subtabs .tab:focus-visible,
  .nav-tabs .nav-link:focus-visible, .tab:focus-visible, .tab-link:focus-visible {
    outline: 2px solid #93C5FD !important;
    outline-offset: 2px;
  }

  /* =========================
     2) Buttons — blue theme
     (KEEP THIS AFTER THE TABS)
     ========================= */
  a.btn, button.btn, .btn,
  .btn.primary, .btn.secondary, .btn.danger, .btn.small {
    background-color: #2563EB !important;
    border-color: #2563EB !important;
    color: #FFFFFF !important;
  }
  a.btn:hover, button.btn:hover, .btn:hover,
  .btn.primary:hover, .btn.secondary:hover, .btn.danger:hover, .btn.small:hover {
    background-color: #1D4ED8 !important;
    border-color: #1D4ED8 !important;
  }
  a.btn:active, button.btn:active, .btn:active,
  .btn.primary:active, .btn.secondary:active, .btn.danger:active, .btn.small:active {
    background-color: #1E40AF !important;
    border-color: #1E40AF !important;
  }
  .btn:disabled { opacity: 0.65; }
</style>
<link rel="manifest" href="{% static 'manifest.webmanifest' %}">
<meta name="theme-color" content="#0f172a">


  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">BondKeeper</div>
    <nav class="mainnav"></nav>
    <div class="spacer"></div>
  </header>
  <main class="page">
    {% block content %}{% endblock %}
  </main>

  <dialog id="modal">
    <div id="modal-body"></div>
    <form method="dialog" style="padding:10px; text-align:right">
      <button class="btn">Close</button>
    </form>
  </dialog>
<script>
  document.body.addEventListener('modal_close', function () {
    const dlg = document.getElementById('modal');
    if (dlg && typeof dlg.close === 'function') dlg.close();
  });
</script>

<!-- Put this near the end of base.html, just before </body> -->
<dialog id="modal" class="modal">
  <article>
    <header>
      <h3 id="modal-title" style="margin:0">Dialog</h3>
      <button class="btn small" onclick="document.getElementById('modal').close()">✕</button>
    </header>
    <div id="modal-body" class="content"></div>
    <footer id="modal-footer" style="display:none"></footer>
  </article>
</dialog>

<style>
  dialog.modal { width: 780px; max-width: 95vw; border: 0; border-radius: 12px; padding: 0; }
  dialog.modal::backdrop { background: rgba(15,23,42,.35); }
  .modal article { display:flex; flex-direction:column; max-height: 85vh; background:#fff; }
  .modal header { display:flex; align-items:center; justify-content:space-between;
                  gap:8px; padding:12px 16px; border-bottom:1px solid #e5e7eb; background:#f8fafc; }
  .modal .content { padding: 14px 16px; overflow:auto; }
  .modal footer { padding: 12px 16px; border-top:1px solid #e5e7eb; display:flex; justify-content:flex-end; gap:8px; }

  /* Nice, roomy form grid */
  .form-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  @media (max-width: 640px) { .form-grid { grid-template-columns: 1fr; } }
  .form-grid .full { grid-column: 1 / -1; }
  .form-grid label { display:block; font-size:12px; color:#64748b; margin-bottom:4px; }
  .form-grid input, .form-grid select, .form-grid textarea { width:100%; }
</style>
<script>
  // Whenever HTMX swaps the Court Dates section, refresh the calendar pane.
  document.body.addEventListener('htmx:afterSwap', function (evt) {
    try {
      var t = evt.detail && evt.detail.target;
      // If the target WAS #subtab-court-dates (or contained within it)...
      if (!t) return;
      var inCourtDates = (t.id === 'subtab-court-dates') ||
                         (t.closest && t.closest('#subtab-court-dates'));
      if (!inCourtDates) return;

      // Find the calendar pane
      var cal = document.getElementById('subtab-calendar-global');
      if (!cal) return;

      // Re-fetch its content using its own hx-get
      var url = cal.getAttribute('hx-get');
      if (url && window.htmx) {
        htmx.ajax('GET', url, { target: '#subtab-calendar-global', swap: 'innerHTML' });
      }
    } catch (e) {
      // swallow any minor issues
    }
  });
</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("{% static 'service-worker.js' %}");
  }
</script>
<script>
(async function(){
  if (!("serviceWorker" in navigator) || !("PushManager" in window)) return;

  function getCookie(name){
    const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return m ? m.pop() : "";
  }

  const reg = await navigator.serviceWorker.ready;
  const vapidRes = await fetch("{% url 'vapid_public' %}", {credentials: "same-origin"});
  const { publicKey } = await vapidRes.json();
  if (!publicKey) return;

  const toUint8 = (b64) => {
    const pad = "=".repeat((4 - b64.length % 4) % 4);
    const raw = atob((b64 + pad).replace(/\-/g, "+").replace(/_/g, "/"));
    return Uint8Array.from([...raw].map(c => c.charCodeAt(0)));
  };

  let sub = await reg.pushManager.getSubscription();
  if (!sub) {
    try {
      sub = await reg.pushManager.subscribe({ userVisibleOnly: true, applicationServerKey: toUint8(publicKey) });
    } catch (e) { return; }
  }

  // save on server
  await fetch("{% url 'push_subscribe' %}", {
    method: "POST",
    headers: { "Content-Type": "application/json", "X-CSRFToken": getCookie("csrftoken") },
    body: JSON.stringify({ subscription: sub.toJSON() })
  });
})();
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}
</script>

</body>
</html>
